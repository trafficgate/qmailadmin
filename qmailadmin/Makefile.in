#
# $Id$
# Copyright (C) 1999-2009 Inter7 Internet Technologies, Inc.
# 

CC = @CC@
AR = ar
CFLAGS = @CFLAGS@ @auth_incs@
LIBS = @LIBS@ @auth_libs@
LDFLAGS = @LDFLAGS@
DEPS = Makefile
INSTALL = @INSTALL@
MKDIR = ./mkinstalldirs

all: qmailadmin

qmailadmin: alias.o auth.o cgi.o command.o dotqmail.o forward.o limits.o mailinglist.o printh.o qmailadmin.o show.o template.o user.o util.o autorespond.o mymailboxes.o
	$(CC) $(LDFLAGS) -o qmailadmin alias.o auth.o cgi.o command.o dotqmail.o forward.o limits.o mailinglist.o printh.o qmailadmin.o show.o template.o user.o util.o autorespond.o mymailboxes.o $(LIBS)

alias.o: alias.c alias.h forward.h config.h qmailadmin.h qmailadminx.h dotqmail.h html.h limits.h util.h printh.h show.h template.h
	$(CC) $(CFLAGS) -o alias.o -c alias.c
auth.o: auth.c cgi.h show.h util.h
	$(CC) $(CFLAGS) -o auth.o -c auth.c
cgi.o: cgi.c cgi.h config.h qmailadmin.h qmailadminx.h util.h
	$(CC) $(CFLAGS) -o cgi.o -c cgi.c
command.o: command.c command.h alias.h autorespond.h cgi.h command.h forward.h mailinglist.h printh.h qmailadmin.h qmailadminx.h show.h user.h util.h mymailboxes.h
	$(CC) $(CFLAGS) -o command.o -c command.c
dotqmail.o: dotqmail.c config.h qmailadmin.h qmailadminx.h
	$(CC) $(CFLAGS) -o dotqmail.o -c dotqmail.c
forward.o: forward.c config.h qmailadmin.h qmailadminx.h
	$(CC) $(CFLAGS) -o forward.o -c forward.c
limits.o: limits.c config.h qmailadmin.h qmailadminx.h
	$(CC) $(CFLAGS) -o limits.o -c limits.c
mailinglist.o: mailinglist.c config.h qmailadmin.h qmailadminx.h
	$(CC) $(CFLAGS) -o mailinglist.o -c mailinglist.c
printh.o: printh.c printh.h
	$(CC) $(CFLAGS) -o printh.o -c printh.c
qmailadmin.o: qmailadmin.c config.h qmailadmin.h
	$(CC) $(CFLAGS) -o qmailadmin.o -c qmailadmin.c
show.o: show.c config.h qmailadmin.h qmailadminx.h
	$(CC) $(CFLAGS) -o show.o -c show.c
template.o: template.c config.h qmailadmin.h qmailadminx.h mymailboxes.h
	$(CC) $(CFLAGS) -o template.o -c template.c
user.o: user.c config.h qmailadmin.h qmailadminx.h
	$(CC) $(CFLAGS) -o user.o -c user.c
util.o: util.c config.h qmailadmin.h qmailadminx.h
	$(CC) $(CFLAGS) -o util.o -c util.c
autorespond.o: autorespond.c config.h qmailadmin.h qmailadminx.h
	$(CC) $(CFLAGS) -o autorespond.o -c autorespond.c
mymailboxes.o: mymailboxes.c mymailboxes.h alias.h cgi.h config.h limits.h printh.h qmailadmin.h qmailadminx.h show.h template.h user.h util.h
	$(CC) $(CFLAGS) -o mymailboxes.o -c mymailboxes.c

install: install-data
	$(MKDIR) $(DESTDIR)@cgibindir@
	$(INSTALL) -o @vpopuser@ -g @vpopgroup@ -m 6755 qmailadmin $(DESTDIR)@cgibindir@

install-data:
	$(MKDIR)         $(DESTDIR)@htmllibdir@
	rm -rf                   $(DESTDIR)@htmllibdir@/html
	$(MKDIR)         $(DESTDIR)@htmllibdir@/html 
	cp html/*.html $(DESTDIR)@htmllibdir@/html
	cp html/colortable $(DESTDIR)@htmllibdir@/html
	chmod 755                $(DESTDIR)@htmllibdir@/html
	chmod 644                $(DESTDIR)@htmllibdir@/html/*
	rm -rf                   $(DESTDIR)@htmllibdir@/lang
	$(MKDIR)         $(DESTDIR)@htmllibdir@/lang 
	cp lang/??     $(DESTDIR)@htmllibdir@/lang
	cp lang/??-??  $(DESTDIR)@htmllibdir@/lang
	chmod 755                $(DESTDIR)@htmllibdir@/lang
	chmod 644                $(DESTDIR)@htmllibdir@/lang/*
	$(MKDIR)         $(DESTDIR)@imagedir@
	cp images/*.png $(DESTDIR)@imagedir@

clean:
	rm -f *.o *.core core qmailadmin
distclean: clean
	rm -rf config.h Makefile autom4te.cache config.log config.status

